"use strict";function choose_matrix(){if(document.getElementById("protein").checked===!0){var a=Object.keys(matrixlist);for(var b in a)document.getElementById("choice_matrix").options[b]=new Option(a[b],a[b])}else if(document.getElementById("nucleotide").checked===!0){var c=Object.keys(matrixEDNA);for(var b in c)document.getElementById("choice_matrix").options[b]=new Option(c[b],c[b])}}function choose_gap_penalty(){var a=document.getElementById("sequence1").value,b=document.getElementById("sequence2").value,c=document.getElementById("gap");for(c.childNodes;c.firstChild;)c.removeChild(c.firstChild);if(document.getElementById("single").checked===!0){var d=document.createElement("input");d.setAttribute("type","number"),d.setAttribute("min","0"),d.setAttribute("id","enter_gap_penalty"),d.setAttribute("value","0"),d.setAttribute("size",2),c.appendChild(d)}if(document.getElementById("multiple").checked===!0)for(var e=Math.max(a.length,b.length),f=0;e-1>=f;f++)if(1==c.hasChildNodes){var d=document.createElement("input");d.insertBefore(d,c.lastChild),d.setAttribute("type","number"),d.setAttribute("min","0"),d.setAttribute("id","enter_gap_penalty"+f),d.setAttribute("value","0"),d.setAttribute("style","width:2em")}else{var d=document.createElement("input");c.appendChild(d),d.setAttribute("type","number"),d.setAttribute("min","0"),d.setAttribute("id","enter_gap_penalty"+f),d.setAttribute("value","0"),d.setAttribute("style","width:2em")}}function get_value(){for(var a,b,c=[],d=document.getElementsByName("algorithm"),e=0;e<d.length;e++)d[e].checked===!0&&(a=d[e].value);for(var f=document.getElementsByName("type_seq"),g=0;g<f.length;g++)f[g].checked===!0&&(b=f[g].value);var h=document.getElementById("sequence1").value,i=document.getElementById("sequence2").value,j=document.getElementById("choice_matrix").options[document.getElementById("choice_matrix").selectedIndex].value,j=matrixlist[j],k=document.getElementById("choice_matrix").options[document.getElementById("choice_matrix").selectedIndex].value,k=matrixEDNA[k];if(document.getElementById("single").checked===!0){var l=document.getElementById("enter_gap_penalty").value,l=-Math.abs(parseInt(l));init(i,h,j,b,a,l)}else if(document.getElementById("multiple").checked===!0){var m=i.length;h.length>m&&(m=h.length);for(var e=0;m>e;e++){var n=document.getElementById("enter_gap_penalty"+e).value;n=Math.abs(parseInt(n)),c.push(-n)}init(i,h,j,b,a,c)}}function init(a,b,c,d,e,f){algorithm(a,b,c,d,e,f),display()}function algorithm(a,b,c,d,e,f){this.seq1=a,this.seq2=b,this.len1=this.seq1.length,this.len2=this.seq2.length,this.matrix=c,this.gap=f,console.log("gap algo ="+this.gap),this.place=0,this.l1,this.l2,this.mat1,this.mat2,this.s1=[],this.s2=[],this.matseq=[],this.matscore=[],this.matpath=[],this.matsumdia=[],this.matsumhor=[],this.matsumvert=[],this.i,this.j,this.size1=len1+1,this.size2=len2+2,this.add,this.maxi=Math.max(this.len1,this.len2),this.algo=e,this.matseq[0]="-",s1=this.seq1.split("");for(var g=0;g<=this.len1;g++)this.matseq.push(s1[g]);this.matseq[this.len1+1]="-",s2=this.seq2.split("");for(var h=0;h<this.len2;h++)this.matseq.push(s2[h]);for(i=0;i<=this.len1;i++)for(j=this.len1+1;j<=this.len1+this.len2+1;j++)this.gap instanceof Array?this.place<this.maxi?this.gapplace=this.gap[place]:this.place%this.maxi===0?this.gapplace=this.gap[0]:this.gapplace=this.gap[this.place%this.maxi]:this.gapplace=this.gap,"smith_waterman"==this.algo?smithwaterman.prototype.score(this.matrix,this.matscore,this.matpath,this.matsumdia,this.matsumvert,this.matsumhor,this.matseq[i],this.matseq[j],this.len2,this.place,this.gapplace):needlemanwunsch.prototype.score(this.matrix,this.matscore,this.matpath,this.matsumdia,this.matsumvert,this.matsumhor,this.matseq[i],this.matseq[j],this.len2,this.place,this.i,this.gapplace),this.place++;if("smith_waterman"==this.algo)var k=smithwaterman.prototype.alignment(matpath,matscore,s1,s2,len1,len2,len2);else var k=needlemanwunsch.prototype.alignment(matpath,matscore,s1,s2,len1,len2,len2);document.getElementById("alignment").innerHTML+="<h3>Alignement</h3>"+k[0]+"<br>"+k[1]}function needlemanwunsch(){for(key in algorithm.prototype)needlemanwunsch.prototype[key]=algorithm.prototype[key]}function smithwaterman(){for(key in algorithm.prototype)smithwaterman.prototype[key]=algorithm.prototype[key]}function timelapse(){step_sum(),step_path()}function step_sum(){document.getElementById("matrixtime").removeChild(matrixtime.childNodes[0]);for(var a=[],b=0,c=document.getElementById("matrixtime"),d=0;d<=size1;d++){c.insertRow(d).setAttribute("id",d);for(var e=0;e<=size2-1;e++)c.rows[d].insertCell(e)}for(var f=document.getElementById("matrixtime").rows,d=0;d<f.length;d++)for(var g=f[d].cells,e=0;e<g.length;e++){if(d>=2&&0===e)for(var g in s1)matrixtime.rows[d].cells[e].innerHTML=s1[g],d++;if(0===d&&e>=2)for(var h in s2)matrixtime.rows[d].cells[e].innerHTML=s2[h],e++;if(d>=1&&1===e){for(scoring in matscore){"visible"==matrixtime.rows[d].cells[e].style.visibility&&(b++,console.log(b)),matrixtime.rows[d].cells[e].setAttribute("id",d+":"+e),matrixtime.rows[d].cells[e].style.visibility="hidden",matrixtime.rows[d].cells[e].innerHTML=matscore[scoring];var i=matrixtime.rows[d].cells[e].getAttribute("id",d+":"+e);a.push(i),e++,e%size2==0&&(d++,e=1)}d=1}}document.getElementById("next").addEventListener("click",pass(a,a[b]))}function pass(a,b){var c;console.log(b);for(var d=0;d<=a.length;d++)document.getElementById(b).style.visibility="visible";c++}function step_path(){document.getElementById("matrixtime2").removeChild(matrixtime2.childNodes[0]);for(var a=document.getElementById("matrixtime2"),b=0;b<=size1;b++){a.insertRow(b);for(var c=0;c<=size2-1;c++)a.rows[b].insertCell(c)}for(var d=document.getElementById("matrixtime2").rows,b=0;b<d.length;b++)for(var e=d[b].cells,c=0;c<e.length;c++){if(b>=2&&0===c)for(var e in s1)matrixtime2.rows[b].cells[c].innerHTML=s1[e],b++;if(0===b&&c>=2)for(var f in s2)matrixtime2.rows[b].cells[c].innerHTML=s2[f],c++;if(b>=1&&1===c){for(path in matpath)0===matpath[path]?(matrixtime2.rows[b].cells[c].setAttribute("id",b+","+c),matrixtime2.rows[b].cells[c].innerHTML='<i class="fa fa-circle-thin"></i>',matrixtime2.rows[b].cells[c].style.visibility="hidden"):1===matpath[path]?(matrixtime2.rows[b].cells[c].setAttribute("id",b+","+c),matrixtime2.rows[b].cells[c].innerHTML='<i class="fa fa-arrow-left"></i>',matrixtime2.rows[b].cells[c].style.visibility="hidden"):2===matpath[path]?(matrixtime2.rows[b].cells[c].setAttribute("id",b+","+c),matrixtime2.rows[b].cells[c].innerHTML='<i class="fa fa-gavel"></i>',matrixtime2.rows[b].cells[c].style.visibility="hidden"):3===matpath[path]&&(matrixtime2.rows[b].cells[c].setAttribute("id",b+","+c),matrixtime2.rows[b].cells[c].innerHTML='<i class="fa fa-arrow-up"></i>',matrixtime2.rows[b].cells[c].style.visibility="hidden"),c++,c%size2==0&&(b++,c=1);b=1}}document.getElementById("next").addEventListener("click",pass2)}function pass2(){for(var a=document.getElementById("matrixtime2").rows,b=0;b<a.length;b++)for(var c=a[b].cells,d=0;d<c.length;d++)if(10===b&10===d)for(y in matrixtime)document.getElementById(b+","+d).style.visibility="visible",d--,d%size2==0&&(b--,d=10)}function display(){document.getElementById("matrixsum").removeChild(matrixsum.childNodes[0]),document.getElementById("matrixpath").removeChild(matrixpath.childNodes[0]);for(var a=document.getElementById("matrixsum"),b=0;b<=size1;b++){a.insertRow(b);for(var c=0;c<=size2-1;c++)a.rows[b].insertCell(c)}for(var d=document.getElementById("matrixsum").rows,b=0;b<d.length;b++)for(var e=d[b].cells,c=0;c<e.length;c++){if(b>=2&&0===c)for(var e in s1)matrixsum.rows[b].cells[c].innerHTML=s1[e],b++;if(0===b&&c>=2)for(var f in s2)matrixsum.rows[b].cells[c].innerHTML=s2[f],c++;if(b>=1&&1===c){for(scoring in matscore)matrixsum.rows[b].cells[c].innerHTML=matscore[scoring],c++,c%size2==0&&(b++,c=1);b=1}}for(var g=document.getElementById("matrixpath"),b=0;b<=size1;b++){g.insertRow(b);for(var c=0;c<=size2-1;c++)g.rows[b].insertCell(c)}for(var h=document.getElementById("matrixpath").rows,b=0;b<h.length;b++)for(var e=h[b].cells,c=0;c<e.length;c++){if(b>=2&&0===c)for(var e in s1)matrixpath.rows[b].cells[c].innerHTML=s1[e],b++;if(0===b&&c>=2)for(var f in s2)matrixpath.rows[b].cells[c].innerHTML=s2[f],c++;if(b>=1&&1===c){for(path in matpath)0===matpath[path]?matrixpath.rows[b].cells[c].innerHTML='<i class="fa fa-circle-thin"></i>':1===matpath[path]?matrixpath.rows[b].cells[c].innerHTML='<i class="fa fa-arrow-left"></i>':2===matpath[path]?matrixpath.rows[b].cells[c].innerHTML='<i class="fa fa-gavel"></i>':3===matpath[path]&&(matrixpath.rows[b].cells[c].innerHTML='<i class="fa fa-arrow-up"></i>'),c++,c%size2==0&&(b++,c=1);b=1}}}needlemanwunsch.prototype.score=function(a,b,c,d,e,f,g,h,i,j,k,l){console.log("gap nw ="+l);var m,n,o,p,q,r,s,t,u,v=["A","R","N","D","C","Q","E","G","H","I","L","K","M","F","P","S","T","W","Y","V","B","Z","X","*"],w=j-(i+1),x=j-1,y=j-(i+2);if(i>=j)b[j]=l*j,c[j]=0,n=0,o=0,p=0,d[j]=0,e[j]=0,f[j]=0;else if(j%(i+1)===0)b[j]=l*k,c[j]=0,n=0,o=0,p=0,d[j]=0,e[j]=0,f[j]=0;else{n=b[w],o=b[x],p=b[y];for(var z in v)g===v[z]&&(t=parseInt(z)),h===v[z]&&(u=parseInt(z));var A=v.length,B=A*t+u;m=parseInt(a[B]),b[j]=m,r=p+m,q=n+l,s=o+l,d[j]=r,e[j]=q,f[j]=s;var C=Math.max(q,r,s);C==s?c[j]=1:C==r?c[j]=2:c[j]=3}},needlemanwunsch.prototype.alignment=function(a,b,c,d,e,f,g){for(var h=b.length-1,i=[],j=[];e>=0&&f>=0;){if(0===a[h]){i.unshift(c[e]),j.unshift(d[f]);break}1===a[h]?(h-=1,i.unshift("-"),j.unshift(d[f]),f--):2===a[h]?(h-=g+2,i.unshift(c[e]),j.unshift(d[f]),e--,f--):(h-=g+1,i.unshift(c[e]),j.unshift("-"),e--)}var k=[i,j];return k},smithwaterman.prototype.score=function(a,b,c,d,e,f,g,h,i,j,k){var l,m,n,o,p,q,r,s,t,u=["A","R","N","D","C","Q","E","G","H","I","L","K","M","F","P","S","T","W","Y","V","B","Z","X","*"],v=j-(i+1),w=j-1,x=j-(i+2);if(i>=j||j%(i+1)===0)b[j]=0,c[j]=0,m=0,n=0,o=0,d[j]=0,e[j]=0,f[j]=0;else{m=b[v],n=b[w],o=b[x];for(var y in u)g===u[y]&&(s=parseInt(y)),h===u[y]&&(t=parseInt(y));var z=u.length,A=z*s+t;l=parseInt(a[A]),b[j]=l,r=o+l,p=m+k,q=n+k,d[j]=r,e[j]=p,f[j]=q;var B=Math.max(p,r,q);B==q?c[j]=1:B==r?c[j]=2:c[j]=3}},smithwaterman.prototype.alignment=function(a,b,c,d,e,f,g){var h,i,j,k,l=0,m=[],n=[],o=[];for(h in b)k=b[h],l=Math.max(l,k);for(i in b)b[i]===l&&m.push(i);for(j in m)for(deppos=m[j];;){if(0===b[deppos]){n.unshift(c[e]),o.unshift(d[f]);break}1===a[deppos]?(deppos-=1,n.unshift("-"),o.unshift(d[f]),f--):2===a[deppos]?(deppos-=g+2,n.unshift(c[e]),o.unshift(d[f]),e--,f--):(deppos-=g+1,n.unshift(c[e]),o.unshift("-"),e--)}var p=[n,o];return p};